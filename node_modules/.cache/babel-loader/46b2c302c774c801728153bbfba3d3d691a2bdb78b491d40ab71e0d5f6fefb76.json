{"ast":null,"code":"import React,{useState,useEffect}from'react';import ApiService from'../services/api';import{CheckSquare,Calendar,Package,AlertCircle}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Overview(){const[tasks,setTasks]=useState([]);const[events,setEvents]=useState([]);const[stock,setStock]=useState([]);const[loading,setLoading]=useState(true);useEffect(()=>{loadData();},[]);const loadData=async()=>{try{const[tasksData,eventsData,stockData]=await Promise.all([ApiService.getTasks().catch(()=>({items:[]})),ApiService.getCalendarEvents().catch(()=>({items:[]})),ApiService.getStock().catch(()=>[])]);setTasks((tasksData.items||[]).filter(t=>t.status!=='completed').slice(0,5));setEvents((eventsData.items||[]).slice(0,5));// Handle stock data format (array or object)\nlet stockItems=[];if(Array.isArray(stockData)){stockItems=stockData.slice(1).map((row,i)=>({id:i,name:row[1]||'',quantity:parseInt(row[2])||0,minQuantity:parseInt(row[3])||0}));}else if(stockData&&typeof stockData==='object'){stockItems=[{id:0,name:\"\".concat(stockData.Marque||'',\" \").concat(stockData['Modéle']||'').trim(),quantity:parseInt(stockData['Quantité restante'])||0,minQuantity:parseInt(stockData['Quantité minimale'])||0}];}setStock(stockItems.filter(item=>item.quantity<=item.minQuantity&&item.minQuantity>0).slice(0,5));}catch(err){console.error(err);}finally{setLoading(false);}};if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Chargement...\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"overview\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stats-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card blue\",children:[/*#__PURE__*/_jsx(CheckSquare,{size:32}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:tasks.length}),/*#__PURE__*/_jsx(\"p\",{children:\"T\\xE2ches en attente\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card green\",children:[/*#__PURE__*/_jsx(Calendar,{size:32}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:events.length}),/*#__PURE__*/_jsx(\"p\",{children:\"Rendez-vous (3j)\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card orange\",children:[/*#__PURE__*/_jsx(Package,{size:32}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:stock.length}),/*#__PURE__*/_jsx(\"p\",{children:\"Stock faible\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-card\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(CheckSquare,{size:20}),\" T\\xE2ches prioritaires\"]}),tasks.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"empty\",children:\"Aucune t\\xE2che en attente\"}):tasks.map(task=>/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-item\",children:[/*#__PURE__*/_jsx(\"span\",{children:task.title}),task.due&&/*#__PURE__*/_jsx(\"small\",{children:new Date(task.due).toLocaleDateString('fr-FR')})]},task.id))]}),/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-card\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(Calendar,{size:20}),\" Prochains RDV\"]}),events.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"empty\",children:\"Aucun rendez-vous\"}):events.map(event=>{var _event$start,_event$start2;return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-item\",children:[/*#__PURE__*/_jsx(\"span\",{children:event.summary}),/*#__PURE__*/_jsx(\"small\",{children:(_event$start=event.start)!==null&&_event$start!==void 0&&_event$start.dateTime?new Date(event.start.dateTime).toLocaleString('fr-FR',{day:'numeric',month:'short',hour:'2-digit',minute:'2-digit'}):new Date((_event$start2=event.start)===null||_event$start2===void 0?void 0:_event$start2.date).toLocaleDateString('fr-FR')})]},event.id);})]}),stock.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-card warning\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[/*#__PURE__*/_jsx(AlertCircle,{size:20}),\" Alertes Stock\"]}),stock.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-item\",children:[/*#__PURE__*/_jsx(\"span\",{children:item.name}),/*#__PURE__*/_jsxs(\"small\",{className:\"warning\",children:[item.quantity,\" / \",item.minQuantity]})]},item.id))]})]})]});}export default Overview;","map":{"version":3,"names":["React","useState","useEffect","ApiService","CheckSquare","Calendar","Package","AlertCircle","jsx","_jsx","jsxs","_jsxs","Overview","tasks","setTasks","events","setEvents","stock","setStock","loading","setLoading","loadData","tasksData","eventsData","stockData","Promise","all","getTasks","catch","items","getCalendarEvents","getStock","filter","t","status","slice","stockItems","Array","isArray","map","row","i","id","name","quantity","parseInt","minQuantity","concat","Marque","trim","item","err","console","error","className","children","size","length","task","title","due","Date","toLocaleDateString","event","_event$start","_event$start2","summary","start","dateTime","toLocaleString","day","month","hour","minute","date"],"sources":["/data/.openclaw/workspace/safeapp-prod/src/components/Overview.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport ApiService from '../services/api';\nimport { CheckSquare, Calendar, Package, AlertCircle } from 'lucide-react';\n\nfunction Overview() {\n  const [tasks, setTasks] = useState([]);\n  const [events, setEvents] = useState([]);\n  const [stock, setStock] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    loadData();\n  }, []);\n\n  const loadData = async () => {\n    try {\n      const [tasksData, eventsData, stockData] = await Promise.all([\n        ApiService.getTasks().catch(() => ({ items: [] })),\n        ApiService.getCalendarEvents().catch(() => ({ items: [] })),\n        ApiService.getStock().catch(() => [])\n      ]);\n\n      setTasks((tasksData.items || []).filter(t => t.status !== 'completed').slice(0, 5));\n      setEvents((eventsData.items || []).slice(0, 5));\n      \n      // Handle stock data format (array or object)\n      let stockItems = [];\n      if (Array.isArray(stockData)) {\n        stockItems = stockData.slice(1).map((row, i) => ({\n          id: i,\n          name: row[1] || '',\n          quantity: parseInt(row[2]) || 0,\n          minQuantity: parseInt(row[3]) || 0\n        }));\n      } else if (stockData && typeof stockData === 'object') {\n        stockItems = [{\n          id: 0,\n          name: `${stockData.Marque || ''} ${stockData['Modéle'] || ''}`.trim(),\n          quantity: parseInt(stockData['Quantité restante']) || 0,\n          minQuantity: parseInt(stockData['Quantité minimale']) || 0\n        }];\n      }\n      setStock(stockItems.filter(item => item.quantity <= item.minQuantity && item.minQuantity > 0).slice(0, 5));\n\n    } catch (err) {\n      console.error(err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) return <div className=\"loading\">Chargement...</div>;\n\n  return (\n    <div className=\"overview\">\n      {/* Stats Cards */}\n      <div className=\"stats-grid\">\n        <div className=\"stat-card blue\">\n          <CheckSquare size={32} />\n          <div>\n            <h3>{tasks.length}</h3>\n            <p>Tâches en attente</p>\n          </div>\n        </div>\n        <div className=\"stat-card green\">\n          <Calendar size={32} />\n          <div>\n            <h3>{events.length}</h3>\n            <p>Rendez-vous (3j)</p>\n          </div>\n        </div>\n        <div className=\"stat-card orange\">\n          <Package size={32} />\n          <div>\n            <h3>{stock.length}</h3>\n            <p>Stock faible</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Recent Items */}\n      <div className=\"dashboard-grid\">\n        <div className=\"dashboard-card\">\n          <h3><CheckSquare size={20} /> Tâches prioritaires</h3>\n          {tasks.length === 0 ? (\n            <p className=\"empty\">Aucune tâche en attente</p>\n          ) : (\n            tasks.map(task => (\n              <div key={task.id} className=\"dashboard-item\">\n                <span>{task.title}</span>\n                {task.due && <small>{new Date(task.due).toLocaleDateString('fr-FR')}</small>}\n              </div>\n            ))\n          )}\n        </div>\n\n        <div className=\"dashboard-card\">\n          <h3><Calendar size={20} /> Prochains RDV</h3>\n          {events.length === 0 ? (\n            <p className=\"empty\">Aucun rendez-vous</p>\n          ) : (\n            events.map(event => (\n              <div key={event.id} className=\"dashboard-item\">\n                <span>{event.summary}</span>\n                <small>\n                  {event.start?.dateTime \n                    ? new Date(event.start.dateTime).toLocaleString('fr-FR', {day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'})\n                    : new Date(event.start?.date).toLocaleDateString('fr-FR')\n                  }\n                </small>\n              </div>\n            ))\n          )}\n        </div>\n\n        {stock.length > 0 && (\n          <div className=\"dashboard-card warning\">\n            <h3><AlertCircle size={20} /> Alertes Stock</h3>\n            {stock.map(item => (\n              <div key={item.id} className=\"dashboard-item\">\n                <span>{item.name}</span>\n                <small className=\"warning\">{item.quantity} / {item.minQuantity}</small>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default Overview;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}