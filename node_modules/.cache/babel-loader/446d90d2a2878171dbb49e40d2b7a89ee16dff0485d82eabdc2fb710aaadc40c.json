{"ast":null,"code":"import React,{useState,useEffect}from'react';import ApiService from'../services/api';import{Package,AlertTriangle}from'lucide-react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Stock(){const[items,setItems]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{loadStock();},[]);const loadStock=async()=>{try{setLoading(true);const data=await ApiService.getStock();// Handle different response formats\nlet items=[];if(Array.isArray(data)){// Array format (rows)\nconst rows=data;items=rows.map((row,index)=>({id:index,reference:row[0]||'',name:row[1]||'',quantity:parseInt(row[2])||0,minQuantity:parseInt(row[3])||0,location:row[4]||'',supplier:row[5]||''}));}else if(data&&typeof data==='object'){// Object format (single item or multiple as object)\nconst rows=Array.isArray(data)?data:[data];items=rows.map((item,index)=>({id:index,reference:item.Type||'',name:\"\".concat(item.Marque||'',\" \").concat(item['Modéle']||'').trim(),quantity:parseInt(item['Quantité restante'])||0,minQuantity:parseInt(item['Quantité minimale'])||0,location:item['Lieu de stockage']||'',supplier:item.Fournisseur||''}));}setItems(items);setError(null);}catch(err){setError(err.message);}finally{setLoading(false);}};const lowStock=items.filter(item=>item.quantity<=item.minQuantity&&item.minQuantity>0);if(loading)return/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"Chargement...\"});if(error)return/*#__PURE__*/_jsxs(\"div\",{className:\"error\",children:[\"Erreur: \",error]});return/*#__PURE__*/_jsxs(\"div\",{className:\"stock-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stock-stats\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card\",children:[/*#__PURE__*/_jsx(Package,{size:32}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:items.length}),/*#__PURE__*/_jsx(\"p\",{children:\"Articles\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"stat-card warning\",children:[/*#__PURE__*/_jsx(AlertTriangle,{size:32}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:lowStock.length}),/*#__PURE__*/_jsx(\"p\",{children:\"Stock faible\"})]})]})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"stock-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"R\\xE9f\\xE9rence\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Nom\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Qt\\xE9\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Min\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Emplacement\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:items.map(item=>/*#__PURE__*/_jsxs(\"tr\",{className:item.quantity<=item.minQuantity?'low-stock':'',children:[/*#__PURE__*/_jsx(\"td\",{children:item.reference}),/*#__PURE__*/_jsx(\"td\",{children:item.name}),/*#__PURE__*/_jsx(\"td\",{className:item.quantity<=item.minQuantity?'warning':'',children:item.quantity}),/*#__PURE__*/_jsx(\"td\",{children:item.minQuantity}),/*#__PURE__*/_jsx(\"td\",{children:item.location})]},item.id))})]})]});}export default Stock;","map":{"version":3,"names":["React","useState","useEffect","ApiService","Package","AlertTriangle","jsx","_jsx","jsxs","_jsxs","Stock","items","setItems","loading","setLoading","error","setError","loadStock","data","getStock","Array","isArray","rows","map","row","index","id","reference","name","quantity","parseInt","minQuantity","location","supplier","item","Type","concat","Marque","trim","Fournisseur","err","message","lowStock","filter","className","children","size","length"],"sources":["/data/.openclaw/workspace/safeapp-prod/src/components/Stock.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport ApiService from '../services/api';\nimport { Package, AlertTriangle } from 'lucide-react';\n\nfunction Stock() {\n  const [items, setItems] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    loadStock();\n  }, []);\n\n  const loadStock = async () => {\n    try {\n      setLoading(true);\n      const data = await ApiService.getStock();\n      // Handle different response formats\n      let items = [];\n      \n      if (Array.isArray(data)) {\n        // Array format (rows)\n        const rows = data;\n        items = rows.map((row, index) => ({\n          id: index,\n          reference: row[0] || '',\n          name: row[1] || '',\n          quantity: parseInt(row[2]) || 0,\n          minQuantity: parseInt(row[3]) || 0,\n          location: row[4] || '',\n          supplier: row[5] || ''\n        }));\n      } else if (data && typeof data === 'object') {\n        // Object format (single item or multiple as object)\n        const rows = Array.isArray(data) ? data : [data];\n        items = rows.map((item, index) => ({\n          id: index,\n          reference: item.Type || '',\n          name: `${item.Marque || ''} ${item['Modéle'] || ''}`.trim(),\n          quantity: parseInt(item['Quantité restante']) || 0,\n          minQuantity: parseInt(item['Quantité minimale']) || 0,\n          location: item['Lieu de stockage'] || '',\n          supplier: item.Fournisseur || ''\n        }));\n      }\n      \n      setItems(items);\n      setError(null);\n    } catch (err) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const lowStock = items.filter(item => item.quantity <= item.minQuantity && item.minQuantity > 0);\n\n  if (loading) return <div className=\"loading\">Chargement...</div>;\n  if (error) return <div className=\"error\">Erreur: {error}</div>;\n\n  return (\n    <div className=\"stock-container\">\n      <div className=\"stock-stats\">\n        <div className=\"stat-card\">\n          <Package size={32} />\n          <div>\n            <h3>{items.length}</h3>\n            <p>Articles</p>\n          </div>\n        </div>\n        <div className=\"stat-card warning\">\n          <AlertTriangle size={32} />\n          <div>\n            <h3>{lowStock.length}</h3>\n            <p>Stock faible</p>\n          </div>\n        </div>\n      </div>\n\n      <table className=\"stock-table\">\n        <thead>\n          <tr>\n            <th>Référence</th>\n            <th>Nom</th>\n            <th>Qté</th>\n            <th>Min</th>\n            <th>Emplacement</th>\n          </tr>\n        </thead>\n        <tbody>\n          {items.map(item => (\n            <tr key={item.id} className={item.quantity <= item.minQuantity ? 'low-stock' : ''}>\n              <td>{item.reference}</td>\n              <td>{item.name}</td>\n              <td className={item.quantity <= item.minQuantity ? 'warning' : ''}>\n                {item.quantity}\n              </td>\n              <td>{item.minQuantity}</td>\n              <td>{item.location}</td>\n            </tr>\n          ))}\n        </tbody>\n      </table>\n    </div>\n  );\n}\n\nexport default Stock;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}