{"ast":null,"code":"import _objectSpread from\"/data/.openclaw/workspace/safeapp-prod/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";const N8N_URL=window.N8N_URL||'https://n8n.superprojetx.com';console.log('SafeApp Dashboard v2.0.1');console.log('n8n URL:',N8N_URL);// Helper to extract data from n8n format\nconst extractItems=data=>{if(!data)return[];// If it's already an array, return it\nif(Array.isArray(data))return data;// If it has items property with n8n format\nif(data.items&&Array.isArray(data.items)){return data.items.map(item=>item.json||item);}// If it's a single object\nreturn[data];};class ApiService{// Tasks\nstatic async getTasks(){try{const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-tasks\"));if(!res.ok)throw new Error(\"HTTP \".concat(res.status));const data=await res.json();return{items:extractItems(data)};}catch(err){console.error('Tasks error:',err);throw err;}}static async createTask(task){const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-task-create\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(task)});if(!res.ok)throw new Error('Erreur création');return res.json();}static async updateTask(listId,taskId,task){const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-task-update\"),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(_objectSpread({listId,taskId},task))});if(!res.ok)throw new Error('Erreur mise à jour');return res.json();}static async deleteTask(listId,taskId){const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-task-delete\"),{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({listId,taskId})});if(!res.ok)throw new Error('Erreur suppression');return res.json();}// Calendar\nstatic async getCalendarEvents(){try{const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-calendar\"));if(!res.ok)throw new Error(\"HTTP \".concat(res.status));const data=await res.json();return{items:extractItems(data)};}catch(err){console.error('Calendar error:',err);throw err;}}// Stock\nstatic async getStock(){try{const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-stock\"));if(!res.ok)throw new Error(\"HTTP \".concat(res.status));const data=await res.json();return extractItems(data);}catch(err){console.error('Stock error:',err);throw err;}}static async updateStock(rowId,quantite){const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-stock-update\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({rowId,quantite})});if(!res.ok)throw new Error(\"HTTP \".concat(res.status));return res.json();}}export default ApiService;","map":{"version":3,"names":["N8N_URL","window","console","log","extractItems","data","Array","isArray","items","map","item","json","ApiService","getTasks","res","fetch","concat","ok","Error","status","err","error","createTask","task","method","headers","body","JSON","stringify","updateTask","listId","taskId","_objectSpread","deleteTask","getCalendarEvents","getStock","updateStock","rowId","quantite"],"sources":["/data/.openclaw/workspace/safeapp-prod/src/services/api.js"],"sourcesContent":["const N8N_URL = window.N8N_URL || 'https://n8n.superprojetx.com';\n\nconsole.log('SafeApp Dashboard v2.0.1');\nconsole.log('n8n URL:', N8N_URL);\n\n// Helper to extract data from n8n format\nconst extractItems = (data) => {\n  if (!data) return [];\n  // If it's already an array, return it\n  if (Array.isArray(data)) return data;\n  // If it has items property with n8n format\n  if (data.items && Array.isArray(data.items)) {\n    return data.items.map(item => item.json || item);\n  }\n  // If it's a single object\n  return [data];\n};\n\nclass ApiService {\n  // Tasks\n  static async getTasks() {\n    try {\n      const res = await fetch(`${N8N_URL}/webhook/safeapp-tasks`);\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      const data = await res.json();\n      return { items: extractItems(data) };\n    } catch (err) {\n      console.error('Tasks error:', err);\n      throw err;\n    }\n  }\n\n  static async createTask(task) {\n    const res = await fetch(`${N8N_URL}/webhook/safeapp-task-create`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(task)\n    });\n    if (!res.ok) throw new Error('Erreur création');\n    return res.json();\n  }\n\n  static async updateTask(listId, taskId, task) {\n    const res = await fetch(`${N8N_URL}/webhook/safeapp-task-update`, {\n      method: 'PUT',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ listId, taskId, ...task })\n    });\n    if (!res.ok) throw new Error('Erreur mise à jour');\n    return res.json();\n  }\n\n  static async deleteTask(listId, taskId) {\n    const res = await fetch(`${N8N_URL}/webhook/safeapp-task-delete`, {\n      method: 'DELETE',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ listId, taskId })\n    });\n    if (!res.ok) throw new Error('Erreur suppression');\n    return res.json();\n  }\n\n  // Calendar\n  static async getCalendarEvents() {\n    try {\n      const res = await fetch(`${N8N_URL}/webhook/safeapp-calendar`);\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      const data = await res.json();\n      return { items: extractItems(data) };\n    } catch (err) {\n      console.error('Calendar error:', err);\n      throw err;\n    }\n  }\n\n  // Stock\n  static async getStock() {\n    try {\n      const res = await fetch(`${N8N_URL}/webhook/safeapp-stock`);\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      const data = await res.json();\n      return extractItems(data);\n    } catch (err) {\n      console.error('Stock error:', err);\n      throw err;\n    }\n  }\n\n  static async updateStock(rowId, quantite) {\n    const res = await fetch(`${N8N_URL}/webhook/safeapp-stock-update`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ rowId, quantite })\n    });\n    if (!res.ok) throw new Error(`HTTP ${res.status}`);\n    return res.json();\n  }\n}\n\nexport default ApiService;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}