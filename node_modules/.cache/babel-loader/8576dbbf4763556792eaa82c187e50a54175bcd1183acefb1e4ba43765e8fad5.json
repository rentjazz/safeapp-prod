{"ast":null,"code":"import _objectSpread from\"/data/.openclaw/workspace/safeapp-prod/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";const N8N_URL=window.N8N_URL||'https://n8n.superprojetx.com';console.log('SafeApp Dashboard v2.0.1');console.log('n8n URL:',N8N_URL);// Helper to extract data from n8n format\nconst extractItems=data=>{console.log('Extract items from:',typeof data,data?Object.keys(data).slice(0,5):'null');if(!data)return[];// If it's already an array, return it\nif(Array.isArray(data))return data;// If it has items property with n8n format\nif(data.items&&Array.isArray(data.items)){return data.items.map(item=>item.json||item);}// If it's an object with numeric keys (n8n output format), convert to array\nif(typeof data==='object'&&!Array.isArray(data)){const keys=Object.keys(data);const numericKeys=keys.filter(k=>!isNaN(parseInt(k))&&k===String(parseInt(k)));console.log('Object keys:',keys.length,'Numeric keys:',numericKeys.length);if(numericKeys.length>0){const result=numericKeys.sort((a,b)=>parseInt(a)-parseInt(b)).map(k=>data[k]);console.log('Converted to array of',result.length,'items');return result;}}// If it's a single object\nreturn[data];};class ApiService{// Tasks\nstatic async getTasks(){try{const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-tasks\"));if(!res.ok)throw new Error(\"HTTP \".concat(res.status));const data=await res.json();return{items:extractItems(data)};}catch(err){console.error('Tasks error:',err);throw err;}}static async createTask(task){const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-task-create\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(task)});if(!res.ok)throw new Error('Erreur création');return res.json();}static async updateTask(listId,taskId,task){const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-task-update\"),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(_objectSpread({listId,taskId},task))});if(!res.ok)throw new Error('Erreur mise à jour');return res.json();}static async deleteTask(listId,taskId){const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-task-delete\"),{method:'DELETE',headers:{'Content-Type':'application/json'},body:JSON.stringify({listId,taskId})});if(!res.ok)throw new Error('Erreur suppression');return res.json();}// Calendar\nstatic async getCalendarEvents(){try{const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-calendar\"));if(!res.ok)throw new Error(\"HTTP \".concat(res.status));const data=await res.json();return{items:extractItems(data)};}catch(err){console.error('Calendar error:',err);throw err;}}// Stock\nstatic async getStock(){try{const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-stock\"));if(!res.ok)throw new Error(\"HTTP \".concat(res.status));const data=await res.json();return extractItems(data);}catch(err){console.error('Stock error:',err);throw err;}}static async updateStock(rowId,quantite){const res=await fetch(\"\".concat(N8N_URL,\"/webhook/safeapp-stock-update\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({rowId,quantite})});if(!res.ok)throw new Error(\"HTTP \".concat(res.status));return res.json();}}export default ApiService;","map":{"version":3,"names":["N8N_URL","window","console","log","extractItems","data","Object","keys","slice","Array","isArray","items","map","item","json","numericKeys","filter","k","isNaN","parseInt","String","length","result","sort","a","b","ApiService","getTasks","res","fetch","concat","ok","Error","status","err","error","createTask","task","method","headers","body","JSON","stringify","updateTask","listId","taskId","_objectSpread","deleteTask","getCalendarEvents","getStock","updateStock","rowId","quantite"],"sources":["/data/.openclaw/workspace/safeapp-prod/src/services/api.js"],"sourcesContent":["const N8N_URL = window.N8N_URL || 'https://n8n.superprojetx.com';\n\nconsole.log('SafeApp Dashboard v2.0.1');\nconsole.log('n8n URL:', N8N_URL);\n\n// Helper to extract data from n8n format\nconst extractItems = (data) => {\n  console.log('Extract items from:', typeof data, data ? Object.keys(data).slice(0, 5) : 'null');\n  if (!data) return [];\n  // If it's already an array, return it\n  if (Array.isArray(data)) return data;\n  // If it has items property with n8n format\n  if (data.items && Array.isArray(data.items)) {\n    return data.items.map(item => item.json || item);\n  }\n  // If it's an object with numeric keys (n8n output format), convert to array\n  if (typeof data === 'object' && !Array.isArray(data)) {\n    const keys = Object.keys(data);\n    const numericKeys = keys.filter(k => !isNaN(parseInt(k)) && k === String(parseInt(k)));\n    console.log('Object keys:', keys.length, 'Numeric keys:', numericKeys.length);\n    if (numericKeys.length > 0) {\n      const result = numericKeys.sort((a, b) => parseInt(a) - parseInt(b)).map(k => data[k]);\n      console.log('Converted to array of', result.length, 'items');\n      return result;\n    }\n  }\n  // If it's a single object\n  return [data];\n};\n\nclass ApiService {\n  // Tasks\n  static async getTasks() {\n    try {\n      const res = await fetch(`${N8N_URL}/webhook/safeapp-tasks`);\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      const data = await res.json();\n      return { items: extractItems(data) };\n    } catch (err) {\n      console.error('Tasks error:', err);\n      throw err;\n    }\n  }\n\n  static async createTask(task) {\n    const res = await fetch(`${N8N_URL}/webhook/safeapp-task-create`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(task)\n    });\n    if (!res.ok) throw new Error('Erreur création');\n    return res.json();\n  }\n\n  static async updateTask(listId, taskId, task) {\n    const res = await fetch(`${N8N_URL}/webhook/safeapp-task-update`, {\n      method: 'PUT',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ listId, taskId, ...task })\n    });\n    if (!res.ok) throw new Error('Erreur mise à jour');\n    return res.json();\n  }\n\n  static async deleteTask(listId, taskId) {\n    const res = await fetch(`${N8N_URL}/webhook/safeapp-task-delete`, {\n      method: 'DELETE',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ listId, taskId })\n    });\n    if (!res.ok) throw new Error('Erreur suppression');\n    return res.json();\n  }\n\n  // Calendar\n  static async getCalendarEvents() {\n    try {\n      const res = await fetch(`${N8N_URL}/webhook/safeapp-calendar`);\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      const data = await res.json();\n      return { items: extractItems(data) };\n    } catch (err) {\n      console.error('Calendar error:', err);\n      throw err;\n    }\n  }\n\n  // Stock\n  static async getStock() {\n    try {\n      const res = await fetch(`${N8N_URL}/webhook/safeapp-stock`);\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      const data = await res.json();\n      return extractItems(data);\n    } catch (err) {\n      console.error('Stock error:', err);\n      throw err;\n    }\n  }\n\n  static async updateStock(rowId, quantite) {\n    const res = await fetch(`${N8N_URL}/webhook/safeapp-stock-update`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ rowId, quantite })\n    });\n    if (!res.ok) throw new Error(`HTTP ${res.status}`);\n    return res.json();\n  }\n}\n\nexport default ApiService;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}